<?xml version="1.0" encoding="UTF-8" ?>
<Module>

  <ModulePrefs title="Hello Gadget"
  description="Hello Description" 
  author="Alan" 
  author_email="alandeng@meijiabang.cn">
    <Optional feature="gadget-directory">
      <Param name="categories">JIRA</Param>
    </Optional>
  </ModulePrefs>

  <Content type="html">
      <![CDATA[
    
        <div id='content_div'></div>
        <script type="text/javascript">

        function fetchIssues() {
          var url = "http://jira.mooyoo.com.cn/rest/api/2/search?jql=assignee=currentUser()"
          var params = {};
          params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
          gadgets.io.makeRequest(url, handleResponse, params);
        }

        function handleResponse(obj) {

          var jsonData = obj.data;
          var issues = jsonData['issues'];
          var html = ""

          for (var i = 0; i < issues.length; i++) {
              var issue = issues[i];
              var key = issue['key'];
              html += "<li>"+ key + "</li>";
          }
          document.getElementById('content_div').innerHTML = html;
        }

        gadgets.util.registerOnLoadHandler(makeJSONRequest);
        </script>
    ]]>
  </Content>

</Module>